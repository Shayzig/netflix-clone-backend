import{c as w,s as v,T as r,p as P,e as p,a as b,i as f,b as T,d as n,f as $}from"./index-3b14350c.js";import{E as S,t as m}from"./vidstack-hTYvsvxZ-80103ed6.js";const g={yj:-1,Gg:0,Jg:1,Og:2,Mg:3,Ng:5},c=class u extends S{constructor(){super(...arguments),this.scope=w(),this.og=v(""),this.J=-1,this.pg=-1,this.qg=0,this.rg=new r(0,0),this.sg=null,this.lg=null,this.mg=null,this.$$PROVIDER_TYPE="YOUTUBE",this.language="en",this.color="red",this.cookies=!1}get Pb(){return this.kg.delegate.Pb}get currentSrc(){return this.sg}get type(){return"video"}get videoId(){return this.og()}preconnect(){const t=[this.tg(),"https://www.google.com","https://i.ytimg.com","https://googleads.g.doubleclick.net","https://static.doubleclick.net"];for(const s of t)P(s,"preconnect")}setup(t){this.kg=t,super.setup(t),p(this.xg.bind(this)),p(this.yg.bind(this)),this.Pb("provider-setup",this)}async play(){const{paused:t}=this.kg.$state;if(b(t))return this.lg||(this.lg=m(()=>{if(this.lg=null,t())return"Timed out."}),this.ng("playVideo")),this.lg.promise}async pause(){const{paused:t}=this.kg.$state;if(!b(t))return this.mg||(this.mg=m(()=>{this.mg=null,t()}),this.ng("pauseVideo")),this.mg.promise}setMuted(t){t?this.ng("mute"):this.ng("unMute")}setCurrentTime(t){this.ng("seekTo",t)}setVolume(t){this.ng("setVolume",t*100)}setPlaybackRate(t){this.ng("setPlaybackRate",t)}async loadSource(t){var e;if(!f(t.src)){this.sg=null,this.og.set("");return}const s=(e=t.src.match(u.zg))==null?void 0:e[1];this.og.set(s??""),this.sg=t}tg(){return this.cookies?"https://www.youtube.com":"https://www.youtube-nocookie.com"}xg(){this.j();const t=this.og();if(!t){this.Ag.set("");return}this.Ag.set(`${this.tg()}/embed/${t}`)}yg(){const t=this.og(),s=u.ug;if(!t)return;if(s.has(t)){const a=s.get(t);this.Pb("poster-change",a);return}const e=new AbortController;return this.Bg(t,e),()=>{e.abort()}}async Bg(t,s){try{const e=["maxresdefault","sddefault","hqdefault"];for(const a of e)for(const o of[!0,!1]){const i=this.Cg(t,a,o);if((await fetch(i,{mode:"no-cors",signal:s.signal})).status<400){u.ug.set(t,i),this.Pb("poster-change",i);return}}}catch{}this.Pb("poster-change","")}Cg(t,s,e){return`https://i.ytimg.com/${e?"vi_webp":"vi"}/${t}/${s}.${e?"webp":"jpg"}`}Kg(){const{keyDisabled:t}=this.kg.$props,{$iosControls:s}=this.kg,{controls:e,muted:a,playsinline:o}=this.kg.$state,i=e()||s();return{autoplay:0,cc_lang_pref:this.language,cc_load_policy:i?1:void 0,color:this.color,controls:i?1:0,disablekb:!i||t()?1:0,enablejsapi:1,fs:1,hl:this.language,iv_load_policy:i?1:3,mute:a()?1:0,playsinline:o()?1:0}}ng(t,s){this.Dg({event:"command",func:t,args:s?[s]:void 0})}Pf(){window.setTimeout(()=>this.Dg({event:"listening"}),100)}Eg(t){this.kg.delegate.Lg(void 0,t)}va(t){var s;(s=this.mg)==null||s.resolve(),this.mg=null,this.Pb("pause",void 0,t)}Fg(t,s){const{duration:e,currentTime:a}=this.kg.$state,o=this.J===g.Gg?e():t,i={currentTime:o,played:this.qg>=o?this.rg:this.rg=new r(0,this.qg)};this.Pb("time-update",i,s),Math.abs(o-a())>1&&this.Pb("seeking",o,s)}vg(t,s,e){const a={buffered:new r(0,t),seekable:s};this.Pb("progress",a,e);const{seeking:o,currentTime:i}=this.kg.$state;o()&&t>i()&&this.wg(e)}wg(t){const{paused:s,currentTime:e}=this.kg.$state;window.clearTimeout(this.pg),this.pg=window.setTimeout(()=>{this.Pb("seeked",e(),t),this.pg=-1},s()?100:0)}Hg(t){const{seeking:s}=this.kg.$state;s()&&this.wg(t),this.Pb("end",void 0,t)}Ig(t,s){var i;const{paused:e}=this.kg.$state,a=t===g.Jg,o=t===g.Mg;switch(o&&this.Pb("waiting",void 0,s),e()&&(o||a)&&((i=this.lg)==null||i.resolve(),this.lg=null,this.Pb("play",void 0,s)),t){case g.Ng:this.Eg(s);break;case g.Jg:this.Pb("playing",void 0,s);break;case g.Og:this.va(s);break;case g.Gg:this.Hg(s);break}this.J=t}Pg({info:t},s){var i;if(!t)return;const{title:e,duration:a,playbackRate:o}=this.kg.$state;if(T(t.videoData)&&t.videoData.title!==e()&&this.Pb("title-change",t.videoData.title,s),n(t.duration)&&t.duration!==a()){if(n(t.videoLoadedFraction)){const h=((i=t.progressState)==null?void 0:i.loaded)??t.videoLoadedFraction*t.duration,l=new r(0,t.duration);this.vg(h,l,s)}this.Pb("duration-change",t.duration,s)}if(n(t.playbackRate)&&t.playbackRate!==o()&&this.Pb("rate-change",t.playbackRate,s),t.progressState){const{current:h,seekableStart:l,seekableEnd:k,loaded:y,duration:d}=t.progressState;this.Fg(h,s),this.vg(y,new r(l,k),s),d!==a()&&this.Pb("duration-change",d,s)}if(n(t.volume)&&$(t.muted)){const h={muted:t.muted,volume:t.volume/100};this.Pb("volume-change",h,s)}n(t.playerState)&&t.playerState!==this.J&&this.Ig(t.playerState,s)}j(){this.J=-1,this.pg=-1,this.qg=0,this.rg=new r(0,0),this.lg=null,this.mg=null}};c.zg=/(?:youtu\.be|youtube|youtube\.com|youtube-nocookie\.com)\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=|)((?:\w|-){11})/;c.ug=new Map;let J=c;export{J as YouTubeProvider};
