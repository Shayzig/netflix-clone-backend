import{c as o,w as n,x as u,y as l,i as c,z as k,e as g,l as a,A as j,B as b,a as f,C as m,E as d,D as G,L as e}from"./index-6a53f99a.js";import{R as p}from"./vidstack-UK1DzmJ--acb29b7a.js";class P{constructor(t,i){this.Tb=t,this.kg=i,this.oj=k(),this.Qj=!1,this.Rj=!1,this.Sj=!1,this.Xg=new p(this._g.bind(this)),this.Vj=void 0,this.ik=void 0,this.Wj(),g(this.Xj.bind(this)),n(this.sj.bind(this))}get Ga(){return this.Tb.media}get Pb(){return this.kg.delegate.Pb}sj(){this.Rj=!1,this.Sj=!1,this.Xg.rc(),this.oj.empty()}_g(){const t=this.Ga.currentTime;this.kg.$state.currentTime()!==t&&this.Pj(t)}Wj(){this.Oj("loadstart",this.Of),this.Oj("abort",this.Uj),this.Oj("emptied",this.Yj),this.Oj("error",this.sd)}Zj(){this.Rj||(this.oj.add(this.Oj("loadeddata",this._j),this.Oj("loadedmetadata",this.$j),this.Oj("canplay",this.ld),this.Oj("canplaythrough",this.ak),this.Oj("durationchange",this.bk),this.Oj("play",this.ua),this.Oj("progress",this.vg),this.Oj("stalled",this.ck),this.Oj("suspend",this.dk)),this.Rj=!0)}ek(){this.Sj||(this.oj.add(this.Oj("pause",this.va),this.Oj("playing",this.fk),this.Oj("ratechange",this.gk),this.Oj("seeked",this.wg),this.Oj("seeking",this.hk),this.Oj("ended",this.Hg),this.Oj("volumechange",this.zd),this.Oj("waiting",this.jh)),this.Sj=!0)}Oj(t,i){return a(this.Ga,t,i.bind(this))}jk(t){}Pj(t,i){const s={currentTime:Math.min(t,this.kg.$state.seekableEnd()),played:this.Ga.played};this.Pb("time-update",s,i)}Of(t){if(this.Ga.networkState===3){this.Uj(t);return}this.Zj(),this.Pb("load-start",void 0,t)}Uj(t){this.Pb("abort",void 0,t)}Yj(){this.Pb("emptied",void 0,event)}_j(t){this.Pb("loaded-data",void 0,t)}$j(t){this.ek(),this.Pb("volume-change",{volume:this.Ga.volume,muted:this.Ga.muted},t),this.Pb("loaded-metadata",void 0,t),j&&b(this.kg.$state.source())&&this.kg.delegate.Lg(this.Tj(),t)}Tj(){return{provider:f(this.kg.$provider),duration:this.Ga.duration,buffered:this.Ga.buffered,seekable:this.Ga.seekable}}ua(t){this.kg.$state.canPlay&&this.Pb("play",void 0,t)}va(t){this.Ga.readyState===1&&!this.Qj||(this.Qj=!1,this.Xg.rc(),this.Pb("pause",void 0,t))}ld(t){this.kg.delegate.Lg(this.Tj(),t)}ak(t){this.kg.$state.started()||this.Pb("can-play-through",this.Tj(),t)}fk(t){this.Qj=!1,this.Pb("playing",void 0,t),this.Xg.qc()}ck(t){this.Pb("stalled",void 0,t),this.Ga.readyState<3&&(this.Qj=!0,this.Pb("waiting",void 0,t))}jh(t){this.Ga.readyState<3&&(this.Qj=!0,this.Pb("waiting",void 0,t))}Hg(t){this.Xg.rc(),this.Pj(this.Ga.duration,t),this.Pb("end",void 0,t),this.kg.$state.loop()&&m(this.Ga.controls)&&(this.Ga.controls=!1)}Xj(){this.kg.$state.paused()&&a(this.Ga,"timeupdate",this.Fg.bind(this))}Fg(t){this.Pj(this.Ga.currentTime,t)}bk(t){this.kg.$state.ended()&&this.Pj(this.Ga.duration,t),this.Pb("duration-change",this.Ga.duration,t)}zd(t){const i={volume:this.Ga.volume,muted:this.Ga.muted};this.Pb("volume-change",i,t)}wg(t){this.Pj(this.Ga.currentTime,t),this.Pb("seeked",this.Ga.currentTime,t),Math.trunc(this.Ga.currentTime)===Math.trunc(this.Ga.duration)&&d(this.Ga.duration)>d(this.Ga.currentTime)&&(this.Pj(this.Ga.duration,t),this.Ga.ended||this.kg.player.dispatch(new G("media-play-request",{trigger:t})))}hk(t){this.Pb("seeking",this.Ga.currentTime,t)}vg(t){const i={buffered:this.Ga.buffered,seekable:this.Ga.seekable};this.Pb("progress",i,t)}dk(t){this.Pb("suspend",void 0,t)}gk(t){this.Pb("rate-change",this.Ga.playbackRate,t)}sd(t){const i=this.Ga.error;if(!i)return;const s={message:i.message,code:i.code,mediaError:i};this.Pb("error",s,t)}}class T{constructor(t,i){this.Tb=t,this.kg=i,this.kk.onaddtrack=this.mk.bind(this),this.kk.onremovetrack=this.nk.bind(this),this.kk.onchange=this.ok.bind(this),a(this.kg.audioTracks,"change",this.pk.bind(this))}get kk(){return this.Tb.media.audioTracks}mk(t){const i=t.track;if(i.label==="")return;const s={id:i.id+"",label:i.label,language:i.language,kind:i.kind,selected:!1};this.kg.audioTracks[e.h](s,t),i.enabled&&(s.selected=!0)}nk(t){const i=this.kg.audioTracks.getById(t.track.id);i&&this.kg.audioTracks[e.f](i,t)}ok(t){let i=this.lk();if(!i)return;const s=this.kg.audioTracks.getById(i.id);s&&this.kg.audioTracks[e.$](s,!0,t)}lk(){return Array.from(this.kk).find(t=>t.enabled)}pk(t){const{current:i}=t.detail;if(!i)return;const s=this.kk.getTrackById(i.id);if(s){const r=this.lk();r&&(r.enabled=!1),s.enabled=!0}}}class v{constructor(t){this.Ga=t,this.scope=o(),this.sg=null}setup(t){new P(this,t),"audioTracks"in this.media&&new T(this,t),n(()=>{this.Ga.setAttribute("src",""),this.Ga.load()})}get type(){return""}get media(){return this.Ga}get currentSrc(){return this.sg}setPlaybackRate(t){this.Ga.playbackRate=t}async play(){return this.Ga.play()}async pause(){return this.Ga.pause()}setMuted(t){this.Ga.muted=t}setVolume(t){this.Ga.volume=t}setCurrentTime(t){this.Ga.currentTime=t}setPlaysinline(t){u(this.Ga,"playsinline",t)}async loadSource({src:t,type:i},s){this.Ga.preload=s||"",l(t)?this.Ga.srcObject=t:(this.Ga.srcObject=null,this.Ga.src=c(t)?t:window.URL.createObjectURL(t)),this.Ga.load(),this.sg={src:t,type:i}}}export{v as H};
